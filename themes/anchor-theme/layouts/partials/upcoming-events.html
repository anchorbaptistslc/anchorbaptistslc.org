{{ $now := now }}
{{ $events := slice }}

{{/* Filter events to only include upcoming ones */}}
{{ if .Params.events }}
  {{ range .Params.events }}
    {{ $eventDate := time .date }}
    {{ $endDate := $eventDate }}
    {{ if .expiryDate }}
      {{ $endDate = time .expiryDate }}
    {{ end }}
    
    {{ if ge $endDate $now }}
      {{ $events = $events | append . }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if gt (len $events) 0 }}
<div id="upcoming-events" class="py-12 bg-brand-light relative">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl mb-6 text-center hero-heading text-brand-dark">Upcoming Events</h2>
    
    <div class="event-carousel relative">
      <div class="event-slides" data-current="0">
        {{ range $index, $event := $events }}
          {{ $eventDate := time .date }}
          {{ $endDate := $eventDate }}
          {{ if .expiryDate }}
            {{ $endDate = time .expiryDate }}
          {{ end }}
          
          <div class="event-slide {{ if eq $index 0 }}active{{ end }}" 
               data-event-date="{{ .date }}" 
               data-event-end="{{ with .expiryDate }}{{ . }}{{ else }}{{ .date }}{{ end }}">
            <div class="relative rounded-lg overflow-hidden shadow-lg">
              <div class="absolute inset-0">
                <img src="{{ partial "image.html" (dict "path" .image "width" "1200") }}" 
                     alt="{{ .title }}" 
                     class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-brand-dark bg-opacity-60"></div>
              </div>
              <div class="relative p-8 md:p-12 text-white">
                <div class="max-w-3xl mx-auto text-center">
                  <h3 class="text-3xl md:text-4xl font-bold mb-4">{{ .title }}</h3>
                  <p class="text-xl mb-4">{{ .description }}</p>
                  <p class="text-lg mb-6">
                    <span class="inline-block bg-brand-light text-brand-dark px-4 py-2 rounded-full">
                      {{ $eventDate.Format "Monday, January 2, 2006" }} at {{ $eventDate.Format "3:04 PM" }}
                    </span>
                  </p>
                  <a href="{{ .cta_url }}" class="inline-block bg-white text-brand-dark px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors duration-200">{{ .cta_text }}</a>
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      </div>
      
      {{ if gt (len $events) 1 }}
      <div class="flex justify-center gap-2 mt-4">
        {{ range $index, $event := $events }}
        <button class="carousel-dot {{ if eq $index 0 }}active{{ end }}" data-slide="{{ $index }}">
          <span class="block w-3 h-3 rounded-full bg-gray-400 transition-colors"></span>
        </button>
        {{ end }}
      </div>
      
      <button class="carousel-nav prev absolute top-1/2 left-4 transform -translate-y-1/2 bg-white bg-opacity-80 rounded-full p-2 shadow-lg z-10 text-brand-dark hover:bg-opacity-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button class="carousel-nav next absolute top-1/2 right-4 transform -translate-y-1/2 bg-white bg-opacity-80 rounded-full p-2 shadow-lg z-10 text-brand-dark hover:bg-opacity-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
      {{ end }}
    </div>
  </div>
</div>
{{ end }} 