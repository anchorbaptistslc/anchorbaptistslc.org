{{ $now := now }}
{{ $events := slice }}

{{/* Filter events to only include upcoming ones */}}
{{ if .Params.events }}
  {{ range .Params.events }}
    {{ $eventDate := time .date }}
    {{ $endDate := $eventDate }}
    {{ if .expiryDate }}
      {{ $endDate = time .expiryDate }}
    {{ end }}
    
    {{ if ge $endDate $now }}
      {{ $events = $events | append . }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if gt (len $events) 0 }}
<div id="upcoming-events" class="py-12 bg-brand-light relative">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl mb-6 text-center hero-heading text-brand-dark">Upcoming Events</h2>
    
    <div class="event-carousel relative">
      <div class="event-slides" data-current="0">
        {{ range $index, $event := $events }}
          {{ $eventDate := time .date }}
          {{ $endDate := $eventDate }}
          {{ if .expiryDate }}
            {{ $endDate = time .expiryDate }}
          {{ end }}
          
          <div class="event-slide {{ if eq $index 0 }}active{{ end }}" 
               data-event-date="{{ .date }}" 
               {{ with .endDate }}data-event-end-date="{{ . }}"{{ end }}
               data-event-expiry="{{ with .expiryDate }}{{ . }}{{ else }}{{ .date }}{{ end }}">
            <div class="relative rounded-lg overflow-hidden shadow-lg event-card">
              <div class="absolute inset-0">
                <img src="{{ partial "image.html" (dict "path" .image "width" "1200") }}" 
                     alt="{{ .title }}" 
                     class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-brand-dark bg-opacity-60"></div>
              </div>
              <div class="relative p-4 md:p-6 text-white event-content">
                <div class="max-w-3xl mx-auto text-center flex flex-col h-full mt-8">
                  <div class="flex-grow">
                    <h3 class="text-2xl md:text-3xl hero-heading mb-3">{{ .title }}</h3>
                    <div class="event-description">
                      <p class="text-lg mb-3">{{ .description }}</p>
                    </div>
                    <p class="text-base mb-4">
                      <span class="inline-block bg-brand-light text-brand-dark px-3 py-1 rounded-full">
                        {{ if .endDate }}
                          {{ $startDate := time .date }}
                          {{ $endDate := time .endDate }}
                          
                          {{ if ne ($startDate.Format "2006") ($endDate.Format "2006") }}
                            {{/* Different years */}}
                            {{ $startDate.Format "January 2, 2006" }} - {{ $endDate.Format "January 2, 2006" }}
                          {{ else if ne ($startDate.Format "January") ($endDate.Format "January") }}
                            {{/* Same year, different months */}}
                            {{ $startDate.Format "January 2" }} - {{ $endDate.Format "January 2, 2006" }}
                          {{ else }}
                            {{/* Same month and year */}}
                            {{ $startDate.Format "January" }} {{ $startDate.Format "2" }}-{{ $endDate.Format "2" }}, {{ $startDate.Format "2006" }}
                          {{ end }}
                        {{ else }}
                          {{ $eventDate.Format "Monday, January 2, 2006" }} at {{ $eventDate.Format "3:04 PM" }}
                        {{ end }}
                      </span>
                    </p>
                  </div>
                  
                  {{ if gt (len $events) 1 }}
                  <div class="flex justify-center gap-2 mt-auto pb-2">
                    {{ range $dotIndex, $_ := $events }}
                    <button class="carousel-dot {{ if eq $dotIndex $index }}active{{ end }}" data-slide="{{ $dotIndex }}">
                      <span class="block w-2 h-2 rounded-full {{ if eq $dotIndex $index }}bg-brand-dark{{ else }}bg-gray-400{{ end }} transition-colors"></span>
                    </button>
                    {{ end }}
                  </div>
                  {{ end }}
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      </div>
      
      {{ if gt (len $events) 1 }}
      <!-- Left and right click areas for navigation -->
      <div class="carousel-click-area carousel-prev absolute inset-y-0 left-0 w-1/5 z-10 cursor-pointer"></div>
      <div class="carousel-click-area carousel-next absolute inset-y-0 right-0 w-1/5 z-10 cursor-pointer"></div>
      {{ end }}
    </div>
  </div>
</div>
{{ end }} 